<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SST Report Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker: Registered'))
          .catch(err => console.log(`Service Worker: Error: ${err}`));
      });
    }
  </script>
  <style>
    :root {
      --primary: #1e40af; /* A strong blue for highlights */
      --secondary: #60a5fa; /* A lighter blue */
      --text-dark: #1f2937; /* A dark gray for main text */
      --text-light: #4b5563; /* A medium gray for labels */
      --bg-light: #f3f4f6; /* A very light gray background */
      --white: #ffffff;
      --border: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }

    body {
      margin: 0;
      background-color: var(--bg-light);
      color: var(--text-dark);
    }

    .wrap {
      max-width: 1200px;
      margin: auto;
      padding: 16px 16px 40px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      margin: 8px 0 24px;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    @media (min-width: 960px) {
      .grid {
        grid-template-columns: 420px 1fr;
      }
    }

    .card {
      background-color: var(--white);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .card h2 {
      font-size: 20px;
      font-weight: 600;
      margin: 0;
      padding: 16px 20px;
      background-color: var(--bg-light);
      border-bottom: 1px solid var(--border);
    }

    .card .body {
      padding: 20px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-top: 14px;
      margin-bottom: 6px;
      color: var(--text-light);
    }

    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    input:focus, textarea:focus, select:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .row .input-container {
      position: relative;
    }
    
    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: var(--white);
      border: 1px solid var(--border);
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .suggestions div {
      padding: 10px 16px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .suggestions div:hover {
      background-color: var(--bg-light);
    }

    .btn {
      display: inline-block;
      background-color: var(--primary);
      color: var(--white);
      border: none;
      padding: 14px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.1s;
    }

    .btn:hover {
      background-color: #1e3a8a;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-group {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* A4 preview */
    .a4 {
      width: 794px;
      min-height: 1123px;
      margin: auto;
      background-color: var(--white);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .report-content {
      border: 3px solid #000;
      padding: 30px;
    }

    .hdr {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      border-bottom: 2px solid #000;
      padding-bottom: 12px;
      margin-bottom: 20px;
    }
    
    .logo {
      width: 70px;
      height: 70px;
      object-fit: contain;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 4px;
    }
    
    .hdr-text {
      flex-grow: 1;
      text-align: left;
    }
    
    .hdr-text div {
      font-size: 14px;
      font-weight: 500;
    }
    
    .hdr-text .title {
      font-weight: bold;
      font-size: 20px;
      margin-top: 6px;
      color: var(--primary);
    }
    
    .hdr-info {
      font-size: 12px;
      border: 1px solid #000;
      padding: 8px 10px;
      border-radius: 8px;
      text-align: right;
    }
    
    .hdr-info div {
      white-space: nowrap;
    }

    .boxtbl {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }
    
    .boxtbl td {
      border: 1px solid #000;
      padding: 10px 8px;
      vertical-align: top;
    }
    
    .boxtbl .lbl {
      font-weight: 600;
      width: 180px;
      text-align: left;
      background-color: #f0f0f0;
    }
    
    .boxtbl td:nth-child(2), .boxtbl td:nth-child(4) {
      font-weight: 500;
      text-align: center;
    }

    .photos {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 20px;
    }
    
    .ph {
      width: 320px; 
      aspect-ratio: 1.5;
      border: 2px solid #000;
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      background-color: var(--bg-light);
    }
    
    .ph img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%); 
      max-width: 100%; 
      max-height: 100%; 
      object-fit: contain; /* ‡§Ø‡§π ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§π‡•à */
    }
    
    .photo-caption {
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      margin: 8px 0;
      color: var(--text-dark);
    }

    .muted {
      font-size: 14px;
      margin-top: 20px;
      text-align: left;
      font-weight: 500;
    }
    
    .foot {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
      font-size: 14px;
    }
    
    .foot div {
      border-top: 1px solid #000;
      padding-top: 8px;
      width: 45%;
      text-align: center;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>üß™ SST Report Generator (Single HTML)</h1>
    <div class="grid">
      <div class="card">
        <h2>‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡•á‡§Ç</h2>
        <div class="body">
          <div class="row">
            <div>
              <label>Company</label>
              <input id="company" value="WELLCOAT TECH"/>
            </div>
            <div>
              <label>Logo (optional)</label>
              <input id="logo" type="file" accept="image/*"/>
            </div>
          </div>

          <label>Report Title</label>
          <input id="title" value="NEUTRAL SALT SPRAY TEST REPORT"/>
          <label>Sub‚ÄëTitle</label>
          <input id="subtitle" value="(TEST CONDUCTED AS PER ASTM B 117)"/>

          <div class="row">
            <div><label>DOC NO</label><input id="docNo" value="DOC NO:014"/></div>
            <div><label>REV NO</label><input id="revNo" value="REV.NO:00"/></div>
          </div>
          <div class="row">
            <div><label>REV DATE</label><input id="revDate" value="01.09.2024"/></div>
            <div><label>TC Date</label><input id="tcDate" value="04.08.2025" readonly/></div>
          </div>
          
          <div class="row">
            <div><label>SST Tag No</label><input id="tag" value="39"/></div>
            <div><label>Production Batch</label><input id="batch" value="250710"/></div>
          </div>
          
          <div class="row">
            <div class="input-container">
              <label>Part No/Name</label>
              <input id="part" value="3871" list="partsList" autocomplete="off"/>
              <datalist id="partsList"></datalist>
            </div>
            <div class="input-container">
              <label>Customer Name</label>
              <input id="customer" value="BG FASTENING AND ENGINEERING" list="customersList" autocomplete="off"/>
              <datalist id="customersList"></datalist>
            </div>
          </div>
          
          <div class="row">
            <div><label>Coating System</label><input id="coatSys" value="Zinc Al. Flake Coating"/></div>
            <div><label>Color</label><input id="color" value="SILVER"/></div>
          </div>
          <div class="row">
            <div><label>Coating Process</label><input id="process" value="Dip spin coating"/></div>
            <div><label>No. of Coat</label><input id="coats" value="2 Base (GEOPERT500) | 1 Top (AQUAZINC)"/></div>
          </div>
          <div class="row">
            <div><label>Coating Thickness</label><input id="thick" value="8‚Äì12 MIC"/></div>
            <div><label>SST Equipment</label><input id="equip" value="B-TEST APP."/></div>
          </div>
          <div class="row">
            <div><label>Capacity</label><input id="capacity" value=">= 450 L"/></div>
            <div><label>Water Type</label><input id="water" value="D.I. Water"/></div>
          </div>
          <div class="row">
            <div><label>Type of Salt</label><input id="salt" value="Lab, Grade NaCl, 5%"/></div>
            <div><label>Customer Requirement (Hrs)</label><input id="req" type="number" value="480" min="0" /></div>
          </div>
          
          <div class="row">
            <div><label>SST Hrs</label><input id="sstHrs" type="number" value="720" min="0" /></div>
            <div><label>Observation for Red Rust</label><input id="obs" value="720 Hrs No red rust" /></div>
          </div>

          <div class="row">
            <div><label>Loaded Date</label><input id="loadDate" value="2025-07-16" type="date"/></div>
            <div><label>Loaded Time</label><input id="loadTime" value="11:00" type="time" readonly/></div>
          </div>
          <div class="row">
            <div><label>Test Stop Date</label><input id="stopDate" value="2025-08-15" type="date" readonly/></div>
            <div><label>Test Stop Time</label><input id="stopTime" value="11:10" type="time" readonly/></div>
          </div>
          
          <div class="row">
            <div><label>No. of Samples</label><input id="samples" value="3"/></div>
            <div><label>Checked By</label><input id="checked" value="SAKSHI CHAVHAN"/></div>
          </div>
          <div class="row">
            <div><label>Approved By</label><input id="approved" value="ABHIJEET DHOKRAT"/></div>
          </div>
          <label>Remark</label>
          <textarea id="remark">Sample SST passed 720 Hrs. No red rust found.</textarea>
          
          <label>Sample Photo (Before)</label>
          <input id="before" type="file" accept="image/*"/>
          <label>Sample Photo (After)</label>
          <input id="after" type="file" accept="image/*"/>
          <br>
          <div class="btn-group">
            <button class="btn" id="btnPreview">Preview Update</button>
            <button class="btn" id="btnPdf">Download PDF</button>
            <button class="btn" id="btnClear">Clear Form</button>
            <button class="btn" id="btnSaveLoad">Save / Load Data</button>
          </div>
          <div style="font-size:12px; color:#6b7280; margin-top:10px;">
            **Save / Load Data:** ‡§Ø‡§π ‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§°‡§æ‡§ü‡§æ ‡§ï‡•ã ‡§Ü‡§™‡§ï‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞ ‡§¶‡•á‡§ó‡§æ‡•§ ‡§Ö‡§ó‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§ú‡§¨ ‡§Ü‡§™ ‡§á‡§∏ ‡§™‡•á‡§ú ‡§ï‡•ã ‡§ñ‡•ã‡§≤‡•á‡§Ç‡§ó‡•á, ‡§§‡•ã ‡§Ü‡§™ ‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§™‡§æ‡§è‡§Ç‡§ó‡•á‡•§
          </div>
        </div>
      </div>

      <div class="card">
        <h2>‡§≤‡§æ‡§á‡§µ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç (A4)</h2>
        <div class="body">
          <div id="preview" class="a4">
            <div class="report-content">
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);
  const state = { logo: "", before: "", after: "" };
  const inputIds = ['company', 'title', 'subtitle', 'docNo', 'revNo', 'revDate', 'tcDate', 'tag', 'batch', 'part', 'customer', 'coatSys', 'color', 'process', 'coats', 'thick', 'equip', 'capacity', 'water', 'salt', 'req', 'sstHrs', 'loadDate', 'loadTime', 'stopDate', 'stopTime', 'obs', 'samples', 'remark', 'checked', 'approved'];

  const defaultValues = {
    company: "WELLCOAT TECH",
    title: "NEUTRAL SALT SPRAY TEST REPORT",
    subtitle: "(TEST CONDUCTED AS PER ASTM B 117)",
    docNo: "DOC NO:014",
    revNo: "REV.NO:00",
    revDate: "01.09.2024",
    tcDate: "2025-08-15",
    tag: "39",
    batch: "250710",
    part: "3871",
    customer: "BG FASTENING AND ENGINEERING",
    coatSys: "Zinc Al. Flake Coating",
    color: "SILVER",
    process: "Dip spin coating",
    coats: "2 Base (GEOPERT500) | 1 Top (AQUAZINC)",
    thick: "8‚Äì12 MIC",
    equip: "B-TEST APP.",
    capacity: ">= 450 L",
    water: "D.I. Water",
    salt: "Lab, Grade NaCl, 5%",
    req: "480",
    sstHrs: "720",
    loadDate: "2025-07-16",
    loadTime: "11:00",
    stopDate: "2025-08-15",
    stopTime: "11:10",
    obs: "720 Hrs No red rust",
    samples: "3",
    remark: "Sample SST passed 720 Hrs. No red rust found.",
    checked: "SAKSHI CHAVHAN",
    approved: "ABHIJEET DHOKRAT"
  };

  let usedCustomers = new Set();
  let usedParts = new Set();

  function loadSuggestions() {
    const savedCustomers = JSON.parse(localStorage.getItem('sstCustomers') || '[]');
    const savedParts = JSON.parse(localStorage.getItem('sstParts') || '[]');
    savedCustomers.forEach(c => usedCustomers.add(c));
    savedParts.forEach(p => usedParts.add(p));
  }
  
  function updateSuggestions() {
    const customerDatalist = $('customersList');
    customerDatalist.innerHTML = '';
    usedCustomers.forEach(customer => {
      const option = document.createElement('option');
      option.value = customer;
      customerDatalist.appendChild(option);
    });
    
    const partDatalist = $('partsList');
    partDatalist.innerHTML = '';
    usedParts.forEach(part => {
      const option = document.createElement('option');
      option.value = part;
      partDatalist.appendChild(option);
    });
  }
  
  function calculateStopDate() {
    const loadDateStr = $('loadDate').value;
    const loadTimeStr = '11:00';
    const sstHours = parseInt($('sstHrs').value, 10);

    if (!loadDateStr || isNaN(sstHours)) {
      $('stopDate').value = '';
      return;
    }

    const [year, month, day] = loadDateStr.split('-').map(Number);
    const [hours, minutes] = loadTimeStr.split(':').map(Number);
    const startDate = new Date(year, month - 1, day, hours, minutes);

    const endDate = new Date(startDate.getTime() + sstHours * 60 * 60 * 1000);

    const endYear = endDate.getFullYear();
    const endMonth = String(endDate.getMonth() + 1).padStart(2, '0');
    const endDay = String(endDate.getDate()).padStart(2, '0');
    const newStopDate = `${endYear}-${endMonth}-${endDay}`;
    
    $('stopDate').value = newStopDate;
    $('tcDate').value = newStopDate;
  }

  function updateObsText() {
      const sstHours = $('sstHrs').value;
      if (sstHours) {
          $('obs').value = `${sstHours} Hrs No red rust`;
      } else {
          $('obs').value = '';
      }
      render();
  }

  function updateRemarkText() {
      const sstHours = $('sstHrs').value;
      if (sstHours) {
          $('remark').value = `Sample SST passed ${sstHours} Hrs. No red rust found.`;
      } else {
          $('remark').value = '';
      }
      render();
  }
  
  function fileToDataURL(file) {
    return new Promise((res, rej) => {
      const reader = new FileReader();
      reader.onload = (e) => res(e.target.result);
      reader.onerror = rej;
      reader.readAsDataURL(file);
    });
  }

  $('logo').addEventListener('change', async e => {
    const f = e.target.files?.[0];
    if (f) state.logo = await fileToDataURL(f);
    render();
  });
  $('before').addEventListener('change', async e => {
    const f = e.target.files?.[0];
    if (f) state.before = await fileToDataURL(f);
    render();
  });
  $('after').addEventListener('change', async e => {
    const f = e.target.files?.[0];
    if (f) state.after = await fileToDataURL(f);
    render();
  });

  function render() {
    const P = $('preview').querySelector('.report-content');
    const v = (id) => $(id).value;
    
    // Convert date format for display
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const [year, month, day] = dateStr.split('-');
      return `${day}.${month}.${year}`;
    }
    
    // Convert time format for display
    function formatTime(timeStr) {
      if (!timeStr) return '';
      const [hours, minutes] = timeStr.split(':');
      const hour = parseInt(hours, 10);
      const ampm = hour >= 12 ? 'pm' : 'am';
      const formattedHour = hour % 12 === 0 ? 12 : hour % 12;
      return `${String(formattedHour).padStart(2, '0')}:${minutes} ${ampm}`;
    }
    
    P.innerHTML = `
      <div class="hdr">
        <div style="display:flex;gap:15px;align-items:center;">
          ${state.logo ? `<img class="logo" src="${state.logo}" alt="Company Logo">` : `<div class="logo" style="display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--text-light);background-color:var(--bg-light);">LOGO</div>`}
          <div class="hdr-text">
            <div style="font-size:22px;font-weight:700;color:var(--primary);">${v('company')}</div>
            <div class="title">${v('title')}</div>
            <div style="font-size:14px;font-weight:500;color:var(--text-light);">${v('subtitle')}</div>
          </div>
        </div>
        <table style="font-size:12px;border-collapse:collapse;border:1px solid #000;height:min-content;margin-top:10px;font-weight:500;">
          <tr><td style="border:1px solid #000;padding:5px 8px;">${v('docNo')}</td></tr>
          <tr><td style="border:1px solid #000;padding:5px 8px;">${v('revNo')}</td></tr>
          <tr><td style="border:1px solid #000;padding:5px 8px;">REV.DATE: ${formatDate(v('revDate'))}</td></tr>
        </table>
      </div>

      <table class="boxtbl">
        ${row('SST Tag No', v('tag'), 'PRODUCTION BATCH', v('batch'))}
        ${row('TC Date', formatDate(v('tcDate')), 'Part No/Name', v('part'))}
        ${row('Customer Name', v('customer'), 'Color', v('color'))}
        ${row('Coating System', v('coatSys'), 'Coating Process', v('process'))}
        ${row('No. of Coat', v('coats'), 'Coating Thickness', v('thick'))}
        ${row('SST Equipment', v('equip'), 'Corrosion Test Apparatus Capacity', v('capacity'))}
        ${row('Water type', v('water'), 'Type of salt', v('salt'))}
        ${row('Component loaded for SST on (Date & time)', formatDate(v('loadDate')) + ' ' + formatTime(v('loadTime')), 'Customer requirement for SST', v('req') + ' Hrs')}
        ${row('Test Stop & Observation Date & Time', formatDate(v('stopDate')) + ' ' + formatTime(v('stopTime')), 'Observation for Red Rust', v('obs'))}
        <tr><td class="lbl">No. of Samples for SST</td><td colspan="3" style="text-align:center;">${v('samples')}</td></tr>
      </table>

      <div class="photos">
        <div>
          <div class="photo-caption">SAMPLE PHOTO BEFORE SST</div>
          <div class="ph">${state.before ? `<img src="${state.before}" alt="Sample before SST">` : 'No image'}</div>
        </div>
        <div>
          <div class="photo-caption">SAMPLE PHOTO AFTER SST</div>
          <div class="ph">${state.after ? `<img src="${state.after}" alt="Sample after SST">` : 'No image'}</div>
        </div>
      </div>

      <div class="muted">Remark: ${v('remark')}</div>
      <div class="foot">
        <div>Checked by: <br><b>${v('checked')}</b></div>
        <div>Approved by: <br><b>${v('approved')}</b></div>
      </div>
    `;
  }

  function row(a, b, c, d) {
    return `<tr><td class="lbl">${a}</td><td style="text-align:center">${b || ''}</td><td class="lbl">${c}</td><td style="text-align:center">${d || ''}</td></tr>`;
  }

  function clearForm() {
    inputIds.forEach(id => {
      const el = $(id);
      if (el) {
        el.value = defaultValues[id] || '';
      }
    });
    $('logo').value = '';
    $('before').value = '';
    $('after').value = '';
    state.logo = state.before = state.after = "";
    render();
  }

  function saveOrLoadData() {
    if (localStorage.getItem('sstReportData')) {
      const savedData = JSON.parse(localStorage.getItem('sstReportData'));
      inputIds.forEach(id => {
        if (savedData[id]) {
          $(id).value = savedData[id];
        }
      });
      state.logo = savedData.logo || "";
      state.before = savedData.before || "";
      state.after = savedData.after || "";
      alert('Data loaded successfully!');
    } else {
      const dataToSave = {};
      inputIds.forEach(id => {
        dataToSave[id] = $(id).value;
      });
      dataToSave.logo = state.logo;
      dataToSave.before = state.before;
      dataToSave.after = state.after;
      localStorage.setItem('sstReportData', JSON.stringify(dataToSave));
      alert('Data saved successfully!');
    }
    render();
  }

  $('btnPreview').addEventListener('click', (e) => {
    e.preventDefault();
    render();
  });

  $('btnPdf').addEventListener('click', async (e) => {
    e.preventDefault();
    
    const customerValue = $('customer').value.trim();
    const partValue = $('part').value.trim();
    if (customerValue) {
      usedCustomers.add(customerValue);
      localStorage.setItem('sstCustomers', JSON.stringify(Array.from(usedCustomers)));
    }
    if (partValue) {
      usedParts.add(partValue);
      localStorage.setItem('sstParts', JSON.stringify(Array.from(usedParts)));
    }
    updateSuggestions();

    const tempEl = document.createElement('div');
    tempEl.classList.add('a4');
    tempEl.style.position = 'absolute';
    tempEl.style.left = '-9999px';
    tempEl.style.top = '-9999px';
    document.body.appendChild(tempEl);

    const v = (id) => $(id).value;
    
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const [year, month, day] = dateStr.split('-');
      return `${day}.${month}.${year}`;
    }
    
    function formatTime(timeStr) {
      if (!timeStr) return '';
      const [hours, minutes] = timeStr.split(':');
      const hour = parseInt(hours, 10);
      const ampm = hour >= 12 ? 'pm' : 'am';
      const formattedHour = hour % 12 === 0 ? 12 : hour % 12;
      return `${String(formattedHour).padStart(2, '0')}:${minutes} ${ampm}`;
    }

    tempEl.innerHTML = `
      <div class="report-content">
        <div class="hdr">
          <div style="display:flex;gap:15px;align-items:center;">
            ${state.logo ? `<img class="logo" src="${state.logo}" alt="Company Logo">` : `<div class="logo" style="display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--text-light);background-color:var(--bg-light);">LOGO</div>`}
            <div class="hdr-text">
              <div style="font-size:22px;font-weight:700;color:var(--primary);">${v('company')}</div>
              <div class="title">${v('title')}</div>
              <div style="font-size:14px;font-weight:500;color:var(--text-light);">${v('subtitle')}</div>
            </div>
          </div>
          <table style="font-size:12px;border-collapse:collapse;border:1px solid #000;height:min-content;margin-top:10px;font-weight:500;">
            <tr><td style="border:1px solid #000;padding:5px 8px;">${v('docNo')}</td></tr>
            <tr><td style="border:1px solid #000;padding:5px 8px;">${v('revNo')}</td></tr>
            <tr><td style="border:1px solid #000;padding:5px 8px;">REV.DATE: ${formatDate(v('revDate'))}</td></tr>
          </table>
        </div>

        <table class="boxtbl">
          ${row('SST Tag No', v('tag'), 'PRODUCTION BATCH', v('batch'))}
          ${row('TC Date', formatDate(v('tcDate')), 'Part No/Name', v('part'))}
          ${row('Customer Name', v('customer'), 'Color', v('color'))}
          ${row('Coating System', v('coatSys'), 'Coating Process', v('process'))}
          ${row('No. of Coat', v('coats'), 'Coating Thickness', v('thick'))}
          ${row('SST Equipment', v('equip'), 'Corrosion Test Apparatus Capacity', v('capacity'))}
          ${row('Water type', v('water'), 'Type of salt', v('salt'))}
          ${row('Component loaded for SST on (Date & time)', formatDate(v('loadDate')) + ' ' + formatTime(v('loadTime')), 'Customer requirement for SST', v('req') + ' Hrs')}
          ${row('Test Stop & Observation Date & Time', formatDate(v('stopDate')) + ' ' + formatTime(v('stopTime')), 'Observation for Red Rust', v('obs'))}
          <tr><td class="lbl">No. of Samples for SST</td><td colspan="3" style="text-align:center;">${v('samples')}</td></tr>
        </table>

        <div class="photos">
          <div>
            <div class="photo-caption">SAMPLE PHOTO BEFORE SST</div>
            <div class="ph">${state.before ? `<img src="${state.before}" alt="Sample before SST">` : 'No image'}</div>
          </div>
          <div>
            <div class="photo-caption">SAMPLE PHOTO AFTER SST</div>
            <div class="ph">${state.after ? `<img src="${state.after}" alt="Sample after SST">` : 'No image'}</div>
          </div>
        </div>

        <div class="muted">Remark: ${v('remark')}</div>
        <div class="foot">
          <div>Checked by: <br><b>${v('checked')}</b></div>
          <div>Approved by: <br><b>${v('approved')}</b></div>
        </div>
      </div>
    `;

    function row(a, b, c, d) {
      return `<tr><td class="lbl">${a}</td><td style="text-align:center">${b || ''}</td><td class="lbl">${c}</td><td style="text-align:center">${d || ''}</td></tr>`;
    }
    
    const canvas = await html2canvas(tempEl, {
      scale: 3,
      backgroundColor: '#fff'
    });
    
    document.body.removeChild(tempEl);

    const img = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    
    const pdf = new jsPDF({ 
      unit: 'pt', 
      format: 'a4',
      orientation: 'portrait'
    });
    
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();
    
    const margin = 20;
    const imgW = pageW - 2 * margin;
    const imgH = imgW * (canvas.height / canvas.width);
    
    let heightLeft = imgH;
    let position = margin;
    
    pdf.addImage(img, 'PNG', margin, position, imgW, imgH);
    heightLeft -= pageH;
    
    while (heightLeft > 0) {
      position = heightLeft - imgH + margin;
      pdf.addPage();
      pdf.addImage(img, 'PNG', margin, position, imgW, imgH);
      heightLeft -= pageH;
    }

    const customerName = $('customer').value.trim() || 'Customer';
    const partNo = $('part').value.trim() || 'PartNo';
    const filename = `${customerName.replace(/[^a-z0-9]/gi, '_')}_${partNo.replace(/[^a-z0-9]/gi, '_')}.pdf`;

    pdf.save(filename);

    alert('PDF report has been downloaded to your default Downloads folder.');
  });

  $('btnClear').addEventListener('click', clearForm);
  $('btnSaveLoad').click(() => {
    if (localStorage.getItem('sstReportData')) {
      const savedData = JSON.parse(localStorage.getItem('sstReportData'));
      inputIds.forEach(id => {
        if (savedData[id]) {
          $(id).value = savedData[id];
        }
      });
      state.logo = savedData.logo || "";
      state.before = savedData.before || "";
      state.after = savedData.after || "";
      alert('Data loaded successfully!');
    } else {
      const dataToSave = {};
      inputIds.forEach(id => {
        dataToSave[id] = $(id).value;
      });
      dataToSave.logo = state.logo;
      dataToSave.before = state.before;
      dataToSave.after = state.after;
      localStorage.setItem('sstReportData', JSON.stringify(dataToSave));
      alert('Data saved successfully!');
    }
    render();
  });
  
  loadSuggestions();
  updateSuggestions();
  
  $('customer').addEventListener('input', updateSuggestions);
  $('part').addEventListener('input', updateSuggestions);
  
  $('loadDate').addEventListener('change', () => { calculateStopDate(); });
  $('sstHrs').addEventListener('input', () => { calculateStopDate(); updateObsText(); updateRemarkText(); });
  
  calculateStopDate();
  render();

  document.addEventListener('keydown', (e) => {
    // Ctrl + Alt + P
    if (e.ctrlKey && e.altKey && e.key === 'p') {
      e.preventDefault();
      $('btnPreview').click();
    }
    // Ctrl + Alt + S
    if (e.ctrlKey && e.altKey && e.key === 's') {
      e.preventDefault();
      $('btnSaveLoad').click();
    }
    // Ctrl + Alt + L
    if (e.ctrlKey && e.altKey && e.key === 'l') {
      e.preventDefault();
      const today = new Date();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const year = today.getFullYear();
      const formattedDate = `${year}-${month}-${day}`;
      
      $('loadDate').value = formattedDate;

      calculateStopDate();
      render();
    }
  });
</script>
</body>
</html>